<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lumireport</title>

    <!-- Imagen de la pestaña -->
    <link
      rel="shortcut icon"
      type="image/svg+xml"
      href="img/lumireport_favicon.svg"
    />
    <!-- link de bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <!-- Link de leaflet -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin="anonymous"
    />

    <!-- Script leaflet -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin="anonymous"
    ></script>

    <!-- Estilo html -->
    <link rel="stylesheet" href="css/style.css" />
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }
      .leaflet-container {
        height: 400px;
        width: 600px;
        max-width: 100%;
        max-height: 100%;
      }
    </style>
  </head>
  <body>
    <!-- Barra de navegacion -->
    <nav
      class="navbar navbar-expand-lg bg-dark border-bottom border-body"
      data-bs-theme="dark"
    >
      <div class="container-fluid">
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarTogglerDemo01"
          aria-controls="navbarTogglerDemo01"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
          <a class="navbar-brand" href="index.html"
            ><img
              src="img/logo_lumireport.png"
              alt="logo-lumireport"
              class="logo-lumireport"
          /></a>
          <ul class="navbar-nav me-auto mb-2 mb-lg-0"></ul>
          <form class="d-flex" role="search">
            <input
              class="form-control me-2"
              type="search"
              placeholder="Search"
              aria-label="Search"
            />
            <!-- Agregar un ID al botón para poder referenciarlo en JavaScript -->
            <button
              type="button"
              class="btn btn-secondary"
              id="btnMostrarCard"
              style="width: 20rem; height: 2.2rem"
            >
              Reporte
            </button>

            <!-- Botón de inicio de sesión -->
            <button
              type="button"
              class="btn btn-success"
              data-bs-toggle="modal"
              data-bs-target="#exampleModal"
              style="width: 20rem; height: 2.2rem"
            >
              Iniciar sesión
            </button>

            <!-- Modal -->
            <div
              class="modal fade"
              id="exampleModal"
              tabindex="-1"
              aria-labelledby="exampleModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">
                      Modal title
                    </h5>
                    <button
                      type="button"
                      class="btn-close"
                      data-bs-dismiss="modal"
                      aria-label="Close"
                    ></button>
                  </div>
                  <div class="modal-body">
                    <p>Modal body text goes here.</p>
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-bs-dismiss="modal"
                    >
                      Close
                    </button>
                    <button type="button" class="btn btn-primary">
                      Save changes
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </form>
          <!-- Tarjeta oculta de formulario-->
          <div
            class="card position-fixed"
            style="
              width: 90%; /* Cambiado a porcentaje para que sea responsivo */
              max-width: 25rem; /* Ancho máximo para evitar que la tarjeta se vuelva demasiado ancha en pantallas grandes */
              height: 80%;
              top: 50px;
              right: 50px;
              z-index: 1000;
              overflow-y: auto; /* Agregado desplazamiento vertical cuando el contenido excede la altura de la tarjeta */
              display: none;
            "
          >
            <img src="img/img_card.svg" class="card-img-top" alt="img-card" />
            <div class="card-body">
              <h5 class="card-title">Formulario de registro</h5>
              <form action="#" method="post">
                <!-- Estilos 1 y 2: Texto a la izquierda, input a la derecha -->
                <div class="form-group">
                  <label for="nombre" class="col-form-label">Nombre:</label>
                  <div class="col">
                    <input
                      type="text"
                      class="form-control"
                      id="nombre"
                      name="nombre"
                      required
                    />
                  </div>
                </div>

                <div class="form-group">
                  <label for="correo" class="col-form-label"
                    >Correo electrónico:</label
                  >
                  <div class="col">
                    <input
                      type="email"
                      class="form-control"
                      id="correo"
                      name="correo"
                      required
                    />
                  </div>
                </div>

                <div class="form-group">
                  <label for="ubicacion" class="col-form-label"
                    >Ubicación del Poste:</label
                  >
                  <div class="col">
                    <input
                      type="text"
                      class="form-control"
                      id="ubicacion"
                      name="ubicacion"
                      required
                    />
                  </div>
                </div>

                <div class="form-group">
                  <label for="tipo_falla" class="col-form-label"
                    >Tipo de Falla:</label
                  >
                  <div class="col">
                    <select
                      class="form-select"
                      id="tipo_falla"
                      name="tipo_falla"
                      required
                    >
                      <option value="luz_intermitente">Luz intermitente</option>
                      <option value="luz_apagada">Luz apagada</option>
                      <option value="luz_parpadeante">Luz parpadeante</option>
                      <option value="otro">Otro</option>
                    </select>
                  </div>
                </div>

                <!-- Estilo 3: Agregar espacio entre texto y input -->
                <div class="form-group">
                  <label for="descripcion" class="col-form-label"
                    >Descripción de la Falla:</label
                  >
                  <div class="col">
                    <textarea
                      class="form-control"
                      id="descripcion"
                      name="descripcion"
                      rows="4"
                      required
                    ></textarea>
                  </div>
                </div>

                <!-- Estilo 3: Agregar espacio entre texto y input -->
                <div class="form-group">
                  <label for="fecha_hora" class="col-form-label"
                    >Fecha y Hora de la Observación:</label
                  >
                  <div class="col">
                    <input
                      type="datetime-local"
                      class="form-control"
                      id="fecha_hora"
                      name="fecha_hora"
                      required
                    />
                  </div>
                </div>

                <!-- Estilo 3: Agregar espacio entre texto y input -->
                <div class="form-group">
                  <label for="adjuntar_foto" class="col-form-label"
                    >Adjuntar Foto:</label
                  >
                  <div class="col">
                    <input
                      type="file"
                      class="form-control"
                      id="adjuntar_foto"
                      name="adjuntar_foto"
                    />
                  </div>
                </div>

                <!-- Estilo 3: Agregar espacio entre texto y input -->
                <div class="form-group">
                  <label for="observaciones" class="col-form-label"
                    >Observaciones adicionales:</label
                  >
                  <div class="col">
                    <textarea
                      class="form-control"
                      id="observaciones"
                      name="observaciones"
                      rows="4"
                    ></textarea>
                  </div>
                </div>

                <!-- Estilo 4: Agregar desplazamiento vertical si es necesario -->
                <div
                  class="form-group"
                  style="overflow-y: auto; max-height: 50vh"
                >
                  <input
                    type="submit"
                    class="btn btn-primary"
                    value="Enviar Reporte"
                  />
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- mapa principal -->
    <div id="map" style="width: 100%; height: 90%"></div>

    <!-- Script para agregar datos json en js -->
    <script src="js/manzanas.js"></script>
    <script src="js/vias.js"></script>
    <script src="js/postes.js"></script>

    <!-- Mapas base -->

    <div Mapa_base>
      <script>
        var map = L.map("map").setView([3.22721, -76.51222], 16);

        //Mapa 1 open street map (mapa principal)
        const tiles = L.tileLayer(
          "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
          {
            maxZoom: 19,
            attribution:
              '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
          }
        ).addTo(map);
        //Mapa 2 Google hibrido
        googleHybrid = L.tileLayer(
          "http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}",
          {
            maxZoom: 20,
            opacity: 0.6,
            subdomains: ["mt0", "mt1", "mt2", "mt3"],
          }
        );
        //Mapa 3 World imagery de ESRI
        var Esri_WorldImagery = L.tileLayer(
          "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
          {
            opacity: 0.6,
            attribution:
              "Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",
          }
        );
        //Mapa 4 Dark Matter
        var CartoDB_DarkMatter = L.tileLayer(
          "https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",
          {
            attribution:
              '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: "abcd",
            maxZoom: 20,
          }
        );

        // Cuadro de convenciones del Mapa base
        const baseLayers = {
          OpenStreetMap: tiles,
          "Esri World Imagery": Esri_WorldImagery,
          CartoDB_DarkMatter: CartoDB_DarkMatter,
          googleHybrid: googleHybrid,
        };

        L.control.layers(baseLayers).addTo(map);
        L.control.scale({ position: "bottomleft" }).addTo(map);
      </script>
      <div formas_basicas>
        <script>
          // Crear popup por defecto
          const popup = L.popup()
            .setLatLng([3.22721, -76.51222])
            .setContent("<b>Bienvenidos a </b><br />Lumireport")
            .openOn(map);

          // Circulo por defecto
          const buffer = L.circle([3.22721, -76.51222], {
            color: "red",
            fillColor: "#f03",
            fillOpacity: 0.5,
            radius: 50,
          })
            .addTo(map)
            .bindPopup("I am a buffer.");

          //   Poligono por defecto
          const polygon = L.polygon([
            [3.231133, -76.516578],
            [3.232954, -76.517984],
            [3.233929, -76.51662],
            [3.232067, -76.5152],
          ])
            .addTo(map)
            .bindPopup("I am a polygon.");

          //   Marcas
          const marker = L.marker([3.22721, -76.51202])
            .addTo(map)
            .bindPopup("<b>Bienvenidos a </b><br />Lumireport")
            .openPopup();

          // Funcion para clickear en el mapa
          function onMapClick(e) {
            popup
              .setLatLng(e.latlng)
              .setContent(`<b>Coordenadas</b><br />${e.latlng.toString()}`)
              .openOn(map);
          }

          map.on("click", onMapClick);
        </script>
      </div>
      <div Capas_proyecto>
        <div>
          <script>
            // Agregar capas desde el geoserver local
            var puntos1 = L.tileLayer
              .wms("http://localhost:8080/geoserver/proyecto_sig3/wms?", {
                layers: "proyecto_sig3:postes",
                format: "image/png",
                transparent: true,
                attribution: "Lumireport-2024",
              })
              .addTo(map);

            var manzanas1 = L.tileLayer
              .wms("http://localhost:8080/geoserver/proyecto_sig3/wms?", {
                layers: "proyecto_sig3:manzanas",
                format: "image/png",
                opacity: 0.4,
                transparent: true,
                attribution: "Lumireport-2024",
              })
              .addTo(map);
            var vias1 = L.tileLayer
              .wms("http://localhost:8080/geoserver/proyecto_sig3/wms?", {
                layers: "proyecto_sig3:vias",
                format: "image/png",
                opacity: 0.6,
                transparent: true,
                attribution: "Lumireport-2024",
              })
              .addTo(map);

          
          </script>
          <script>
            // Agregar las capas GeoJSON
            L.geoJSON(manzanas).addTo(map);
            L.geoJSON(vias).addTo(map);
            L.geoJSON(postes).addTo(map);
          </script>
        </div>
      </div>
    </div>

    <!-- Script js -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      $(document).ready(function () {
        // Mostrar la tarjeta al hacer clic en el botón "Reporte"
        $("#btnMostrarCard").click(function () {
          $(".card").toggle();
          $(".card").css("z-index", "1000");
        });

        // Cerrar la tarjeta al presionar la tecla "Esc"
        $(document).keydown(function (event) {
          if (event.key === "Escape") {
            $(".card").hide();
          }
        });
      });
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
